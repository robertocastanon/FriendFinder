<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous" />

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
        <title>Survey</title>
    </head>

<body>
    <div class="container">
        <h1>Survey Questions <a href="/"><button type="button" class="float-right btn btn-lg btn-primary"><h4><i class="fas fa-home"></i> Go Home</h4></button></a></h1>
        <hr>
        <h2><strong>About You!</strong></h2>
        <h4>Name (Required)</h4>
        <input type="text" id="name" class="form-control" required>

        <h4>Link to an Image (Required)</h4>
        <input type="text" id="photo" class="form-control" required>

        <hr>

        <h3><strong>Question 1</strong></h3>
        <h4>Cats are furry</h4>
        <select class="chosen-select" id="q1">
          <option value=""></option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>

        <h3><strong>Question 2</strong></h3>
        <h4>Aliens are real</h4>
        <select class="chosen-select" id="q2">
          <option value=""></option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>

        <h3><strong>Question 3</strong></h3>
        <h4>The color yellow is objectively bad</h4>
        <select class="chosen-select" id="q3">
          <option value=""></option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>

        <h3><strong>Question 4</strong></h3>
        <h4>Skyler from Breaking Bad is annoying</h4>
        <select class="chosen-select" id="q4">
          <option value=""></option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>

        <h3><strong>Question 5</strong></h3>
        <h4>Mondays are not that bad</h4>
        <select class="chosen-select" id="q5">
          <option value=""></option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>

        <h3><strong>Question 6</strong></h3>
        <h4>Butter on popcorn</h4>
        <select class="chosen-select" id="q6">
          <option value=""></option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>

        <h3><strong>Question 7</strong></h3>
        <h4>Playing a game is only fun when you win</h4>
        <select class="chosen-select" id="q7">
          <option value=""></option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>

        <h3><strong>Question 8</strong></h3>
        <h4>Summer is the best season of the year</h4>
        <select class="chosen-select" id="q8">
          <option value=""></option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>

        <h3><strong>Question 9</strong></h3>
        <h4>It's okay to lie</h4>
        <select class="chosen-select" id="q9">
          <option value=""></option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>

        <h3><strong>Question 10</strong></h3>
        <h4>The internet is better than TV</h4>
        <select class="chosen-select" id="q10">
          <option value=""></option>
          <option value="1">1 (Strongly Disagree)</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 (Strongly Agree)</option>
        </select>

        <br>
        <br>

            <button type="button" id="submitBtn"class="btn btn-primary" data-toggle="modal" data-target="#results-modal">
              Submit
            </button>

        <hr>

        <footer class="footer">
                <div class="container">
                  <p><a href="/api/friends">API Friends List</a> | <a href="https://github.com/robertocastanon/FriendFinder">GitHub Repo</a></p>
                </div>
        </footer>
    </div>

<!-- Modal -->
<div class="modal fade" id="results-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Your new Best Friend is....</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        ...
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
</body>

<script type='text/JavaScript'>

// sets the score, total to 0 or empty
var modalBody = document.querySelector('.modal-body')
var scores = []
var total = 0

//capture form inputs
document.querySelector('#submitBtn').addEventListener('click', function(event) {
  event.preventDefault();
  var friendChange = []
  var totalChange = []
  var biggChange = { change: 1000}

  // capture the values that the issue input
  // capture the name, photo url and the score
  var add = {
    name: document.querySelector('#name').value.trim(),
    photo: document.querySelector('#photo').value.trim(),
    scores: [
      document.querySelector('#q1').value,
      document.querySelector('#q2').value,
      document.querySelector('#q3').value,
      document.querySelector('#q4').value,
      document.querySelector('#q5').value,
      document.querySelector('#q6').value,
      document.querySelector('#q7').value,
      document.querySelector('#q8').value,
      document.querySelector('#q9').value,
      document.querySelector('#q10').value
    ]
  }
  // console.log info
  console.log(add)
  console.log('Name: ' + add.name)
  console.log('Photo Link: ' + add.name)
  console.log(add.scores)
  console.log(add.scores[0])

  // nonn functional catch if else
  // this is here just for an example

  // scores = []
  // if (document.querySelector('#name').value === "") {
  //   console.log('wowowowowowowowoowowowowowowow')
  //   document.querySelector('#submitBtn').toggleAttribute('data-toggle')
  //   alert('Fill in the entire survey please')
  //   return false
  // } else {
  //   name = ''
  //   photo = ''
  //   console.log('else')
  //   document.querySelector('#submitBtn').toggleAttribute('data-toggle')
  //   launchFetch()
  // }

  console.log('test')
  scores = 0
  
  var addFriend = {
    name: name,
    photo: photo,
    scores: scores
  }

  // start of the fetch sequence
  console.log('launch')

  //grabs in the data inside the friends.js file
  //post that sends the info the user input into friendArray in friends.js
  fetch('/api/friends', {
    method: 'POST',
    body: JSON.stringify(add),
    headers: {
      'Content-Type': 'application/json'
    }
  })
  .then(response => {
    return response.json()
  })
  .then(data => {
    // pop() excludes what the issue input in the comparing match function
    data.pop()
    for (let friend of data) {
      total = 0
      // create new array with map() to return score
      totalChange = friend.scores.map(function (item, index) {
        return Math.abs(item - add.scores[index]);
      })
      for (let val of totalChange) {
        total += val;
      }
      // push friendArray
      friend.change = total
      friendChange.push(friend)
    }
    // finds the best match
    for (let diff of friendChange) {
      if(diff.change < biggChange.change) {
        biggChange = diff
      }
    }
    //adds content to the modal
    modalBody.innerHTML = `<h1>${biggChange.name}</h1>
    <hr>
    <img src='${biggChange.photo}' width=75%>`
    console.log('Friends change', friendChange)
    console.log('Your new friend', biggChange.name)
    console.log('img url', biggChange.photo)
  })
})
</script>

</html>